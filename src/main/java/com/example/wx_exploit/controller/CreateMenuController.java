package com.example.wx_exploit.controller;

import com.example.wx_exploit.pojo.*;
import com.example.wx_exploit.util.TokenUtil;
import com.example.wx_exploit.util.weixinSignUtil;
import net.sf.json.JSON;
import net.sf.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author 李皓
 * @version 1.0.0
 * @ClassName CreateMenuController.java
 * @Description TODO
 * @createTime 2021年08月13日 14:36:00
 */
@RestController
@RequestMapping("/wx")
public class CreateMenuController {

    @Value("${wx.mp.cdurl}")
    private String cdurl;

    @Autowired
    private weixinSignUtil weixinSignUtil;

    /**
     * 创建菜单
     * @return
     */
    @GetMapping("/pushCreateMenu")
    public String pushCreateMenu(){
        //菜单对象
        Button button = new Button();
        //一级菜单
        button.getButton().add(new ClickButton("点击","1"));
        //第二个一级菜单
        button.getButton().add(new ViewButton("百度","http://www.baidu.com"));
        //第三个一级菜单
        SubButton subButton = new SubButton("我的");
        //第三个菜单中的子菜单
        subButton.getSub_button().add(new PhotoOrAlbumButton("发图片","31"));
        subButton.getSub_button().add(new ClickButton("点我","32"));
        subButton.getSub_button().add(new ViewButton("百度","http://www.baidu.com"));
        //加入第三个一级菜单
        button.getButton().add(subButton);
        //将菜单对象转为JSON
        JSONObject jsonObject = JSONObject.fromObject(button);
        String url = cdurl.replace("ACCESS_TOKEN",weixinSignUtil.getAccessToken());
        String post = weixinSignUtil.post(url, jsonObject.toString());
        JSONObject jsonObject1 = JSONObject.fromObject(post);
        if (jsonObject1.getString("errmsg").equals("ok")){
            return "创建成功";
        }else {
            return "创建失败";
        }
    }

    @GetMapping("/pushIndustry")
    public String pushIndustry(){
        String accessToken = weixinSignUtil.getAccessToken();
        String url = "https://api.weixin.qq.com/cgi-bin/template/api_set_industry?access_token="+accessToken;
        String data = "{\n" +
                "    \"industry_id1\":\"1\",\n" +
                "    \"industry_id2\":\"2\"\n" +
                "}";
        String post = weixinSignUtil.post(url, data);
        JSONObject jsonObject = JSONObject.fromObject(post);
        System.out.println(jsonObject);
        if (jsonObject.getString("errmsg").equals("ok")){
            return "设置成功";
        }else {
           return "创建失败";
        }
    }

    @GetMapping("/getIndustry")
    public String getIndustry(){
        String accessToken = weixinSignUtil.getAccessToken();
        String url = "https://api.weixin.qq.com/cgi-bin/template/get_industry?access_token="+accessToken;
        String Industry = TokenUtil.getToken(url);
        return Industry;
    }

}
